on:
  push:
    branches:
      - main
    paths-ignore:
      - '.gitignore'
      - 'Makefile'
      - 'README.md'
  pull_request:
    branches:
      - main
    paths-ignore:
      - '.gitignore'
      - 'Makefile'
      - 'README.md'

name: basic-check

jobs:
  fmt:
    name: format
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: dtolnay/rust-toolchain@nightly
        with:
          toolchain: nightly-2025-08-04
          components: rustfmt
      - name: Check Rust formatting
        run: cargo fmt --all -- --check

  lint:
    name: lint
    runs-on: ubuntu-latest
    steps:
      - name: Install Protoc
        uses: arduino/setup-protoc@v3
      - name: Configure git for private repo
        run: |
          git config --global url."https://${{ secrets.GH_TOKEN }}:@github.com/".insteadOf "https://github.com/"
      - name: Checkout sources
        uses: actions/checkout@v5
      - name: Install toolchain
        uses: dtolnay/rust-toolchain@nightly
        with:
          toolchain: nightly-2025-08-04
          components: clippy
      - name: Rust cache
        uses: Swatinem/rust-cache@v2
      - name: Clippy
        run: |
          cargo clippy --workspace --lib --examples --tests --benches --all-features --locked -- -D warnings
